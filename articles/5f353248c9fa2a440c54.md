---
title: "Next.js v12.0.0ã§ã€Œheap out of memoryã€ãŒç™ºç”Ÿã—ãŸã¨ãã®å›é¿æ³•"
emoji: "ğŸª›"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ['nextjs','error']
published: true
---

[Next.jsã®v12](https://nextjs.org/blog/next-12)ãŒãƒªãƒªãƒ¼ã‚¹ã•ã‚ŒãŸã®ã§ã€è©¦ã—ã«ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚¢ãƒƒãƒ—ã—ã¦ã€`next dev`ã‚’ã™ã‚‹ã¨ä»¥ä¸‹ã®ã‚ˆã†ãªã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã€‚
`NODE_OPTIONS`ã®`max-old-space-size`ã‚’å¤‰æ›´ã—ã¦ã¿ã¦ã‚‚æ”¹å–„ã•ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚
```
<--- Last few GCs --->

[3344:0x118008000]    36324 ms: Mark-sweep (reduce) 2045.4 (2051.5) -> 2044.7 (2052.3) MB, 5051.5 / 0.1 ms  (average mu = 0.042, current mu = 0.001) allocation failure scavenge might not succeed


<--- JS stacktrace --->

FATAL ERROR: Ineffective mark-compacts near heap limit Allocation failed - JavaScript heap out of memory

...

```
## å›é¿æ³•
ãƒªãƒªãƒ¼ã‚¹å¾Œæ—©ã€…ã«issueãŒä¸ŠãŒã£ã¦ãŠã‚Šã€å›é¿æ³•ã‚‚ä¸ŠãŒã£ã¦ã„ãŸã®ã§ã‚·ã‚§ã‚¢ã—ã¾ã™ã€‚
ã©ã†ã‚„ã‚‰Chakra UIã‚’åˆ©ç”¨ã—ã¦ã„ã‚‹ã¨å½±éŸ¿ãŒå‡ºã‚‹ã¿ãŸã„ã§ã™ã€‚ï¼ˆè‡ªåˆ†ã®ç’°å¢ƒã§ã‚‚Chakra UIã‚’åˆ©ç”¨ã—ã¦ã„ã¾ã—ãŸï¼‰

:::message
ä¸€æ™‚çš„ãªå¯¾å‡¦æ³•ã«éããªã„ãŸã‚ã€ä»Šå¾Œã®å‹•å‘ã«ã¤ã„ã¦ã¯issueã‚„ãƒªãƒªãƒ¼ã‚¹æƒ…å ±ãªã©ã‚’ã”ç¢ºèªãã ã•ã„ã€‚
:::

https://github.com/vercel/next.js/issues/30330

next.config.jsã«ä»¥ä¸‹ã‚’è¿½è¨˜ã™ã‚‹
```js:next.config.js
module.exports = {
  experimental: {
    esmExternals: false
  }
}
```


å†åº¦ã€`next dev`ã‚’ã™ã‚‹ã¨ç„¡äº‹localhostã«æ¥ç¶šã§ãã¾ã—ãŸï¼

## å‚ç…§
https://github.com/vercel/next.js/issues/30330#issuecomment-952172377